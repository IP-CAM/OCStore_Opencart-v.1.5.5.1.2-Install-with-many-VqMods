<?php
class ModelCatalogSearchSuggestion extends Model{public function getProducts($ab6a73945cc2c0c162a10741d8e4dba3a=array()){$this->load->model('catalog/product');$aebc0757cff8b6c86850b1c3b5cf3b3f7=$this->config->get('search_suggestion_options');if(!$aebc0757cff8b6c86850b1c3b5cf3b3f7){$aebc0757cff8b6c86850b1c3b5cf3b3f7=array();}$a8268139db43009af0cf20c2f5569e649=isset($aebc0757cff8b6c86850b1c3b5cf3b3f7['search_logic'])?$aebc0757cff8b6c86850b1c3b5cf3b3f7['search_logic']:'and';if($this->customer->isLogged()){$a3df461aa6b0606b0a92a06f6ed78cdcd=$this->customer->getCustomerGroupId();}else{$a3df461aa6b0606b0a92a06f6ed78cdcd=$this->config->get('config_customer_group_id');}$a5e794424027fb0fd7079a829bd5b7d95=array();if(isset($aebc0757cff8b6c86850b1c3b5cf3b3f7['search_cache'])){$ad331c6aea73be6ffb635de261b217d24=md5(http_build_query($ab6a73945cc2c0c162a10741d8e4dba3a+$aebc0757cff8b6c86850b1c3b5cf3b3f7));$a5e794424027fb0fd7079a829bd5b7d95=$this->cache->get('product.'.(int)$this->config->get('config_language_id').'.'.(int)$this->config->get('config_store_id').'.'.(int)$a3df461aa6b0606b0a92a06f6ed78cdcd.'.'.$ad331c6aea73be6ffb635de261b217d24);}if(!$a5e794424027fb0fd7079a829bd5b7d95){$a53f164fd58eba7fe7ef558ef2df17f85="SELECT p.product_id, (SELECT AVG(rating) AS total FROM ".DB_PREFIX."review r1 WHERE r1.product_id = p.product_id AND r1.status = '1' GROUP BY r1.product_id) AS rating FROM ".DB_PREFIX."product p LEFT JOIN ".DB_PREFIX."product_description pd ON (p.product_id = pd.product_id) LEFT JOIN ".DB_PREFIX."product_to_store p2s ON (p.product_id = p2s.product_id)";if(!empty($ab6a73945cc2c0c162a10741d8e4dba3a['filter_category_id'])){$a53f164fd58eba7fe7ef558ef2df17f85.=" LEFT JOIN ".DB_PREFIX."product_to_category p2c ON (p.product_id = p2c.product_id)";}$a53f164fd58eba7fe7ef558ef2df17f85.=" WHERE pd.language_id = '".(int)$this->config->get('config_language_id')."' AND p.status = '1' AND p.date_available <= NOW() AND p2s.store_id = '".(int)$this->config->get('config_store_id')."'";if(!empty($ab6a73945cc2c0c162a10741d8e4dba3a['filter_name'])||!empty($ab6a73945cc2c0c162a10741d8e4dba3a['filter_tag'])||!empty($ab6a73945cc2c0c162a10741d8e4dba3a['filter_model'])||!empty($ab6a73945cc2c0c162a10741d8e4dba3a['filter_sku'])){$a53f164fd58eba7fe7ef558ef2df17f85.=" AND (";if(!empty($ab6a73945cc2c0c162a10741d8e4dba3a['filter_name'])){$aabffbed326a99c3885669ea5b4cb6917=array();$a38805b4dffc28f2b1a76a54d8ac80649=explode(' ',trim(preg_replace('/\s\s+/',' ',$ab6a73945cc2c0c162a10741d8e4dba3a['filter_name'])));foreach($a38805b4dffc28f2b1a76a54d8ac80649 as $a8c549705a35fcf50c18d7ffa026f48a8){if(!empty($ab6a73945cc2c0c162a10741d8e4dba3a['filter_description'])){$aabffbed326a99c3885669ea5b4cb6917[]="(LCASE(pd.name) LIKE '%".$this->db->escape(utf8_strtolower($a8c549705a35fcf50c18d7ffa026f48a8))."%' OR LCASE(pd.description) LIKE '%".$this->db->escape(utf8_strtolower($a8c549705a35fcf50c18d7ffa026f48a8))."%')";}else{$aabffbed326a99c3885669ea5b4cb6917[]="LCASE(pd.name) LIKE '%".$this->db->escape(utf8_strtolower($a8c549705a35fcf50c18d7ffa026f48a8))."%'";}}if($aabffbed326a99c3885669ea5b4cb6917){$a53f164fd58eba7fe7ef558ef2df17f85.=" ".implode(" ".$a8268139db43009af0cf20c2f5569e649." ",$aabffbed326a99c3885669ea5b4cb6917)."";}}if(!empty($ab6a73945cc2c0c162a10741d8e4dba3a['filter_name'])&&!empty($ab6a73945cc2c0c162a10741d8e4dba3a['filter_tag'])){$a53f164fd58eba7fe7ef558ef2df17f85.=" OR ";}if(!empty($ab6a73945cc2c0c162a10741d8e4dba3a['filter_tag'])){$aabffbed326a99c3885669ea5b4cb6917=array();$a38805b4dffc28f2b1a76a54d8ac80649=explode(' ',trim(preg_replace('/\s\s+/',' ',$ab6a73945cc2c0c162a10741d8e4dba3a['filter_tag'])));foreach($a38805b4dffc28f2b1a76a54d8ac80649 as $a8c549705a35fcf50c18d7ffa026f48a8){$aabffbed326a99c3885669ea5b4cb6917[]="LCASE(pd.tag) LIKE '%".$this->db->escape(utf8_strtolower($a8c549705a35fcf50c18d7ffa026f48a8))."%'";}if($aabffbed326a99c3885669ea5b4cb6917){$a53f164fd58eba7fe7ef558ef2df17f85.=" ".implode(" OR ",$aabffbed326a99c3885669ea5b4cb6917)." ";}}if((!empty($ab6a73945cc2c0c162a10741d8e4dba3a['filter_name'])||!empty($ab6a73945cc2c0c162a10741d8e4dba3a['filter_tag']))&&!empty($ab6a73945cc2c0c162a10741d8e4dba3a['filter_model'])){$a53f164fd58eba7fe7ef558ef2df17f85.=" OR ";}if(!empty($ab6a73945cc2c0c162a10741d8e4dba3a['filter_model'])){$aabffbed326a99c3885669ea5b4cb6917=array();$a38805b4dffc28f2b1a76a54d8ac80649=explode(' ',trim(preg_replace('/\s\s+/',' ',$ab6a73945cc2c0c162a10741d8e4dba3a['filter_model'])));foreach($a38805b4dffc28f2b1a76a54d8ac80649 as $a8c549705a35fcf50c18d7ffa026f48a8){$aabffbed326a99c3885669ea5b4cb6917[]="LCASE(p.model) LIKE '%".$this->db->escape(utf8_strtolower($a8c549705a35fcf50c18d7ffa026f48a8))."%'";}if($aabffbed326a99c3885669ea5b4cb6917){$a53f164fd58eba7fe7ef558ef2df17f85.=" ".implode(" OR ",$aabffbed326a99c3885669ea5b4cb6917)." ";}}if((!empty($ab6a73945cc2c0c162a10741d8e4dba3a['filter_name'])||!empty($ab6a73945cc2c0c162a10741d8e4dba3a['filter_tag'])||!empty($ab6a73945cc2c0c162a10741d8e4dba3a['filter_model']))&&!empty($ab6a73945cc2c0c162a10741d8e4dba3a['filter_sku'])){$a53f164fd58eba7fe7ef558ef2df17f85.=" OR ";}if(!empty($ab6a73945cc2c0c162a10741d8e4dba3a['filter_sku'])){$aabffbed326a99c3885669ea5b4cb6917=array();$a38805b4dffc28f2b1a76a54d8ac80649=explode(' ',trim(preg_replace('/\s\s+/',' ',$ab6a73945cc2c0c162a10741d8e4dba3a['filter_sku'])));foreach($a38805b4dffc28f2b1a76a54d8ac80649 as $a8c549705a35fcf50c18d7ffa026f48a8){$aabffbed326a99c3885669ea5b4cb6917[]="LCASE(p.sku) LIKE '%".$this->db->escape(utf8_strtolower($a8c549705a35fcf50c18d7ffa026f48a8))."%'";}if($aabffbed326a99c3885669ea5b4cb6917){$a53f164fd58eba7fe7ef558ef2df17f85.=" ".implode(" OR ",$aabffbed326a99c3885669ea5b4cb6917)." ";}}$a53f164fd58eba7fe7ef558ef2df17f85.=")";}if(!empty($ab6a73945cc2c0c162a10741d8e4dba3a['filter_category_id'])){if(!empty($ab6a73945cc2c0c162a10741d8e4dba3a['filter_sub_category'])){$afc5bca84909b21f8c70fc39594ebc7e2=array();$afc5bca84909b21f8c70fc39594ebc7e2[]="p2c.category_id = '".(int)$ab6a73945cc2c0c162a10741d8e4dba3a['filter_category_id']."'";$this->load->model('catalog/category');$a62932c0e85c61e70d9c216f34150b2ce=$this->model_catalog_category->getCategoriesByParentId($ab6a73945cc2c0c162a10741d8e4dba3a['filter_category_id']);foreach($a62932c0e85c61e70d9c216f34150b2ce as $a696c15187510351ab2e40cf360caef93){$afc5bca84909b21f8c70fc39594ebc7e2[]="p2c.category_id = '".(int)$a696c15187510351ab2e40cf360caef93."'";}$a53f164fd58eba7fe7ef558ef2df17f85.=" AND (".implode(' OR ',$afc5bca84909b21f8c70fc39594ebc7e2).")";}else{$a53f164fd58eba7fe7ef558ef2df17f85.=" AND p2c.category_id = '".(int)$ab6a73945cc2c0c162a10741d8e4dba3a['filter_category_id']."'";}}if(!empty($ab6a73945cc2c0c162a10741d8e4dba3a['filter_manufacturer_id'])){$a53f164fd58eba7fe7ef558ef2df17f85.=" AND p.manufacturer_id = '".(int)$ab6a73945cc2c0c162a10741d8e4dba3a['filter_manufacturer_id']."'";}$a53f164fd58eba7fe7ef558ef2df17f85.=" GROUP BY p.product_id";$ad4cfd38e7b98bf797ad39db1f09a72d0=array('pd.name','p.model','p.quantity','p.price','rating','p.sort_order','p.date_added');if(isset($ab6a73945cc2c0c162a10741d8e4dba3a['sort'])&&in_array($ab6a73945cc2c0c162a10741d8e4dba3a['sort'],$ad4cfd38e7b98bf797ad39db1f09a72d0)){if($ab6a73945cc2c0c162a10741d8e4dba3a['sort']=='pd.name'||$ab6a73945cc2c0c162a10741d8e4dba3a['sort']=='p.model'){$a53f164fd58eba7fe7ef558ef2df17f85.=" ORDER BY LCASE(".$ab6a73945cc2c0c162a10741d8e4dba3a['sort'].")";}else{$a53f164fd58eba7fe7ef558ef2df17f85.=" ORDER BY ".$ab6a73945cc2c0c162a10741d8e4dba3a['sort'];}}else{$a53f164fd58eba7fe7ef558ef2df17f85.=" ORDER BY p.sort_order";}if(isset($ab6a73945cc2c0c162a10741d8e4dba3a['order'])&&($ab6a73945cc2c0c162a10741d8e4dba3a['order']=='DESC')){$a53f164fd58eba7fe7ef558ef2df17f85.=" DESC, LCASE(pd.name) DESC";}else{$a53f164fd58eba7fe7ef558ef2df17f85.=" ASC, LCASE(pd.name) ASC";}if(isset($ab6a73945cc2c0c162a10741d8e4dba3a['start'])||isset($ab6a73945cc2c0c162a10741d8e4dba3a['limit'])){if($ab6a73945cc2c0c162a10741d8e4dba3a['start']<0){$ab6a73945cc2c0c162a10741d8e4dba3a['start']=0;}if($ab6a73945cc2c0c162a10741d8e4dba3a['limit']<1){$ab6a73945cc2c0c162a10741d8e4dba3a['limit']=20;}$a53f164fd58eba7fe7ef558ef2df17f85.=" LIMIT ".(int)$ab6a73945cc2c0c162a10741d8e4dba3a['start'].",".(int)$ab6a73945cc2c0c162a10741d8e4dba3a['limit'];}$a5e794424027fb0fd7079a829bd5b7d95=array();$a896c67c75dba42ad95dfb8bb3ffaf7c3=$this->db->query($a53f164fd58eba7fe7ef558ef2df17f85);foreach($a896c67c75dba42ad95dfb8bb3ffaf7c3->rows as $a49c8b72225e402bac0ca2319d67d77b2){$a5e794424027fb0fd7079a829bd5b7d95[$a49c8b72225e402bac0ca2319d67d77b2['product_id']]=$this->model_catalog_product->getProduct($a49c8b72225e402bac0ca2319d67d77b2['product_id']);}if(isset($aebc0757cff8b6c86850b1c3b5cf3b3f7['search_cache'])){$this->cache->set('product.'.(int)$this->config->get('config_language_id').'.'.(int)$this->config->get('config_store_id').'.'.(int)$a3df461aa6b0606b0a92a06f6ed78cdcd.'.'.$ad331c6aea73be6ffb635de261b217d24,$a5e794424027fb0fd7079a829bd5b7d95);}}return $a5e794424027fb0fd7079a829bd5b7d95;}public function getTotalProducts($ab6a73945cc2c0c162a10741d8e4dba3a=array()){$aebc0757cff8b6c86850b1c3b5cf3b3f7=$this->config->get('search_suggestion_options');if(!$aebc0757cff8b6c86850b1c3b5cf3b3f7){$aebc0757cff8b6c86850b1c3b5cf3b3f7=array();}$a8268139db43009af0cf20c2f5569e649=isset($aebc0757cff8b6c86850b1c3b5cf3b3f7['search_logic'])?$aebc0757cff8b6c86850b1c3b5cf3b3f7['search_logic']:'and';$a53f164fd58eba7fe7ef558ef2df17f85="SELECT COUNT(DISTINCT p.product_id) AS total FROM ".DB_PREFIX."product p LEFT JOIN ".DB_PREFIX."product_description pd ON (p.product_id = pd.product_id) LEFT JOIN ".DB_PREFIX."product_to_store p2s ON (p.product_id = p2s.product_id)";if(!empty($ab6a73945cc2c0c162a10741d8e4dba3a['filter_category_id'])){$a53f164fd58eba7fe7ef558ef2df17f85.=" LEFT JOIN ".DB_PREFIX."product_to_category p2c ON (p.product_id = p2c.product_id)";}$a53f164fd58eba7fe7ef558ef2df17f85.=" WHERE pd.language_id = '".(int)$this->config->get('config_language_id')."' AND p.status = '1' AND p.date_available <= NOW() AND p2s.store_id = '".(int)$this->config->get('config_store_id')."'";if(!empty($ab6a73945cc2c0c162a10741d8e4dba3a['filter_name'])||!empty($ab6a73945cc2c0c162a10741d8e4dba3a['filter_tag'])||!empty($ab6a73945cc2c0c162a10741d8e4dba3a['filter_model'])||!empty($ab6a73945cc2c0c162a10741d8e4dba3a['filter_sku'])){$a53f164fd58eba7fe7ef558ef2df17f85.=" AND (";if(!empty($ab6a73945cc2c0c162a10741d8e4dba3a['filter_name'])){$aabffbed326a99c3885669ea5b4cb6917=array();$a38805b4dffc28f2b1a76a54d8ac80649=explode(' ',trim(preg_replace('/\s\s+/',' ',$ab6a73945cc2c0c162a10741d8e4dba3a['filter_name'])));foreach($a38805b4dffc28f2b1a76a54d8ac80649 as $a8c549705a35fcf50c18d7ffa026f48a8){if(!empty($ab6a73945cc2c0c162a10741d8e4dba3a['filter_description'])){$aabffbed326a99c3885669ea5b4cb6917[]="(LCASE(pd.name) LIKE '%".$this->db->escape(utf8_strtolower($a8c549705a35fcf50c18d7ffa026f48a8))."%' OR LCASE(pd.description) LIKE '%".$this->db->escape(utf8_strtolower($a8c549705a35fcf50c18d7ffa026f48a8))."%')";}else{$aabffbed326a99c3885669ea5b4cb6917[]="LCASE(pd.name) LIKE '%".$this->db->escape(utf8_strtolower($a8c549705a35fcf50c18d7ffa026f48a8))."%'";}}if($aabffbed326a99c3885669ea5b4cb6917){$a53f164fd58eba7fe7ef558ef2df17f85.=" ".implode(" ".$a8268139db43009af0cf20c2f5569e649." ",$aabffbed326a99c3885669ea5b4cb6917)."";}}if(!empty($ab6a73945cc2c0c162a10741d8e4dba3a['filter_name'])&&!empty($ab6a73945cc2c0c162a10741d8e4dba3a['filter_tag'])){$a53f164fd58eba7fe7ef558ef2df17f85.=" OR ";}if(!empty($ab6a73945cc2c0c162a10741d8e4dba3a['filter_tag'])){$aabffbed326a99c3885669ea5b4cb6917=array();$a38805b4dffc28f2b1a76a54d8ac80649=explode(' ',trim(preg_replace('/\s\s+/',' ',$ab6a73945cc2c0c162a10741d8e4dba3a['filter_tag'])));foreach($a38805b4dffc28f2b1a76a54d8ac80649 as $a8c549705a35fcf50c18d7ffa026f48a8){$aabffbed326a99c3885669ea5b4cb6917[]="LCASE(pd.tag) LIKE '%".$this->db->escape(utf8_strtolower($a8c549705a35fcf50c18d7ffa026f48a8))."%'";}if($aabffbed326a99c3885669ea5b4cb6917){$a53f164fd58eba7fe7ef558ef2df17f85.=" ".implode(" OR ",$aabffbed326a99c3885669ea5b4cb6917)." ";}}if((!empty($ab6a73945cc2c0c162a10741d8e4dba3a['filter_name'])||!empty($ab6a73945cc2c0c162a10741d8e4dba3a['filter_tag']))&&!empty($ab6a73945cc2c0c162a10741d8e4dba3a['filter_model'])){$a53f164fd58eba7fe7ef558ef2df17f85.=" OR ";}if(!empty($ab6a73945cc2c0c162a10741d8e4dba3a['filter_model'])){$aabffbed326a99c3885669ea5b4cb6917=array();$a38805b4dffc28f2b1a76a54d8ac80649=explode(' ',trim(preg_replace('/\s\s+/',' ',$ab6a73945cc2c0c162a10741d8e4dba3a['filter_model'])));foreach($a38805b4dffc28f2b1a76a54d8ac80649 as $a8c549705a35fcf50c18d7ffa026f48a8){$aabffbed326a99c3885669ea5b4cb6917[]="LCASE(p.model) LIKE '%".$this->db->escape(utf8_strtolower($a8c549705a35fcf50c18d7ffa026f48a8))."%'";}if($aabffbed326a99c3885669ea5b4cb6917){$a53f164fd58eba7fe7ef558ef2df17f85.=" ".implode(" OR ",$aabffbed326a99c3885669ea5b4cb6917)." ";}}if((!empty($ab6a73945cc2c0c162a10741d8e4dba3a['filter_name'])||!empty($ab6a73945cc2c0c162a10741d8e4dba3a['filter_tag'])||!empty($ab6a73945cc2c0c162a10741d8e4dba3a['filter_model']))&&!empty($ab6a73945cc2c0c162a10741d8e4dba3a['filter_sku'])){$a53f164fd58eba7fe7ef558ef2df17f85.=" OR ";}if(!empty($ab6a73945cc2c0c162a10741d8e4dba3a['filter_sku'])){$aabffbed326a99c3885669ea5b4cb6917=array();$a38805b4dffc28f2b1a76a54d8ac80649=explode(' ',trim(preg_replace('/\s\s+/',' ',$ab6a73945cc2c0c162a10741d8e4dba3a['filter_sku'])));foreach($a38805b4dffc28f2b1a76a54d8ac80649 as $a8c549705a35fcf50c18d7ffa026f48a8){$aabffbed326a99c3885669ea5b4cb6917[]="LCASE(p.sku) LIKE '%".$this->db->escape(utf8_strtolower($a8c549705a35fcf50c18d7ffa026f48a8))."%'";}if($aabffbed326a99c3885669ea5b4cb6917){$a53f164fd58eba7fe7ef558ef2df17f85.=" ".implode(" OR ",$aabffbed326a99c3885669ea5b4cb6917)." ";}}$a53f164fd58eba7fe7ef558ef2df17f85.=")";}if(!empty($ab6a73945cc2c0c162a10741d8e4dba3a['filter_category_id'])){if(!empty($ab6a73945cc2c0c162a10741d8e4dba3a['filter_sub_category'])){$afc5bca84909b21f8c70fc39594ebc7e2=array();$afc5bca84909b21f8c70fc39594ebc7e2[]="p2c.category_id = '".(int)$ab6a73945cc2c0c162a10741d8e4dba3a['filter_category_id']."'";$this->load->model('catalog/category');$a62932c0e85c61e70d9c216f34150b2ce=$this->model_catalog_category->getCategoriesByParentId($ab6a73945cc2c0c162a10741d8e4dba3a['filter_category_id']);foreach($a62932c0e85c61e70d9c216f34150b2ce as $a696c15187510351ab2e40cf360caef93){$afc5bca84909b21f8c70fc39594ebc7e2[]="p2c.category_id = '".(int)$a696c15187510351ab2e40cf360caef93."'";}$a53f164fd58eba7fe7ef558ef2df17f85.=" AND (".implode(' OR ',$afc5bca84909b21f8c70fc39594ebc7e2).")";}else{$a53f164fd58eba7fe7ef558ef2df17f85.=" AND p2c.category_id = '".(int)$ab6a73945cc2c0c162a10741d8e4dba3a['filter_category_id']."'";}}if(!empty($ab6a73945cc2c0c162a10741d8e4dba3a['filter_manufacturer_id'])){$a53f164fd58eba7fe7ef558ef2df17f85.=" AND p.manufacturer_id = '".(int)$ab6a73945cc2c0c162a10741d8e4dba3a['filter_manufacturer_id']."'";}$a896c67c75dba42ad95dfb8bb3ffaf7c3=$this->db->query($a53f164fd58eba7fe7ef558ef2df17f85);return $a896c67c75dba42ad95dfb8bb3ffaf7c3->row['total'];}}
//author sv2109 (sv2109@gmail.com) license for 1 product copy granted for rhel (shipka2008@mail.ru )
